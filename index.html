<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ekran Paylaşımı</title>
</head>
<body>
  <button id="startButton">Ekran Paylaşımı Başlat</button>
  <button id="stopButton">Ekran Paylaşımını Durdur</button>
  <video id="screenVideo" autoplay></video>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const screenVideo = document.getElementById('screenVideo');
    const socket = io();

    let peerConnection;
    let screenStream;

    startButton.addEventListener('click', async () => {
      screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });
      screenVideo.srcObject = screenStream;

      peerConnection = new RTCPeerConnection();
      screenStream.getTracks().forEach(track => peerConnection.addTrack(track, screenStream));

      const offer = await peerConnection.createOffer();
      await peerConnection.setLocalDescription(offer);
      socket.emit('offer', offer);

      socket.on('answer', async (answer) => {
        await peerConnection.setRemoteDescription(answer);
      });

      peerConnection.onicecandidate = (event) => {
        if (event.candidate) {
          socket.emit('candidate', event.candidate);
        }
      };

      socket.on('candidate', async (candidate) => {
        await peerConnection.addIceCandidate(new RTCIceCandidate(candidate));
      });
    });

    stopButton.addEventListener('click', () => {
      screenStream.getTracks().forEach(track => track.stop());
      peerConnection.close();
    });

    socket.on('offer', async (offer) => {
      peerConnection = new RTCPeerConnection();

      peerConnection.ontrack = (event) => {
        screenVideo.srcObject = event.streams[0];
      };

      await peerConnection.setRemoteDescription(offer);
      const answer = await peerConnection.createAnswer();
      await peerConnection.setLocalDescription(answer);
      socket.emit('answer', answer);

      peerConnection.onicecandidate = (event) => {
        if (event.candidate) {
          socket.emit('candidate', event.candidate);
        }
      };

      socket.on('candidate', async (candidate) => {
        await peerConnection.addIceCandidate(new RTCIceCandidate(candidate));
      });
    });
  </script>
</body>
</html>
